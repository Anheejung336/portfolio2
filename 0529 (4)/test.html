<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/MotionPathPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/ScrollToPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/ScrollTrigger.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        section {
            width: 100vw;
            height: 100vh;
            display: flex;
        }

        .box {
            width: 253px;
            height: 253px;
            background: #ABA8FF;
            position: relative;
            overflow: hidden;
        }

        .wave-fill-wrapper {
            display: flex;
            gap: 40px;
            justify-content: center;
            align-items: center;
            margin-top: 40px;
        }

        .water {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: red;
            transform: translateY(100%);
            z-index: 1;
            transition: transform 0.3s;
        }

        .water_wave {
            width: 200%;
            position: absolute;
            bottom: 100%;
        }

        .water_wave_back {
            right: 0;
            fill: yellow;
            animation: wave-back 1.4s infinite linear;
            opacity: .5;
        }

        .water_wave_front {
            left: 0;
            fill: yellow;
            animation: wave-front 0.7s infinite linear;
        }

        @keyframes wave-front {
            100% {
                transform: translate(-50%, 0);
            }
        }

        @keyframes wave-back {
            100% {
                transform: translate(50%, 0);
            }
        }

        .wave-group {
            transition: transform 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fill-rect {
            transition: y 2s cubic-bezier(0.4, 0, 0.2, 1)
        }
    </style>
</head>

<body>
    <section>
        <!-- wave 정의 -->
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <!--             <symbol id="wave" viewBox="0 0 560 20">
    <path d="M0,10 Q35,20 70,10 T140,10 T210,10 T280,10 T350,10 T420,10 T490,10 T560,10 V20 H0 Z"></path>
</symbol> -->
            <symbol id="wave">
                <path
                    d="M420,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C514,6.5,518,4.7,528.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7v20H420z">
                </path>
                <path
                    d="M420,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C326,6.5,322,4.7,311.5,2.7C304.3,1.4,293.6-0.1,280,0v20H420z">
                </path>
                <path
                    d="M140,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C234,6.5,238,4.7,248.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7v20H140z">
                </path>
                <path
                    d="M140,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C46,6.5,42,4.7,31.5,2.7C24.3,1.4,13.6-0.1,0,0v20H140z">
                </path>
            </symbol>
        </svg>
        <!-- clip-path 정의 -->
        <svg width="0" height="0" class="clip-svg">
            <defs>
                <clipPath id="clip-shape1">
                    <path d="M304.284 269H1.71582L153 2.02832L304.284 269Z" />
                </clipPath>
                <clipPath id="clip-shape2">
                    <path d="M254 1V254H1V1H254Z" />
                </clipPath>
                <clipPath id="clip-shape3">
                    <path d="M292.864 106.604L250.046 277H43.9541L1.13477 106.604L147.009 1.2334L292.864 106.604Z" />
                </clipPath>
                <clipPath id="clip-shape4">
                    <path d="M233.431 1L310.837 131.5L233.431 262H78.5693L1.16211 131.5L78.5693 1H233.431Z" />
                </clipPath>
            </defs>
        </svg>

        <!-- 박스(예시) -->
        <div class="box">
            <div class="water" id="water">
                <svg viewBox="0 0 560 20" class="water_wave water_wave_back">
                    <use xlink:href="#wave"></use>
                </svg>
                <svg viewBox="0 0 560 20" class="water_wave water_wave_front">
                    <use xlink:href="#wave"></use>
                </svg>
            </div>
        </div>

        <!-- 도형별 wave+선+점 애니메이션 SVG -->
        <div class="wave-fill-wrapper">
            <!-- shape1 -->
            <svg class="wave-fill shape1" width="306" height="270" viewBox="0 0 306 270">
                <g clip-path="url(#clip-shape1)">
                    <rect class="fill-rect" x="0" y="270" width="306" height="270" fill="#fff" />
                    <g class="wave-group" transform="translate(0,270)">
                        <use xlink:href="#wave" class="water_wave water_wave_back" fill="#b3b3ff" y="0" />
                        <use xlink:href="#wave" class="water_wave water_wave_front" fill="#fff" y="0" />
                    </g>
                    <path class="draw-path" d="M304.284 269H1.71582L153 2.02832L304.284 269Z" stroke="white"
                        stroke-width="2" fill="none" />
                </g>
            </svg>
            <!-- shape2 -->
            <svg class="wave-fill shape2" width="255" height="255" viewBox="0 0 255 255">
                <g clip-path="url(#clip-shape2)">
                    <rect class="fill-rect" x="0" y="255" width="255" height="255" fill="#fff" />
                    <g class="wave-group" style="transform:translateY(100%);">
                        <use xlink:href="#wave" class="water_wave water_wave_back" fill="white" y="235" />
                        <use xlink:href="#wave" class="water_wave water_wave_front" fill="white" y="235" />
                    </g>
                    <path class="draw-path" d="M254 1V254H1V1H254Z" stroke="white" stroke-width="2" fill="none" />
                </g>
            </svg>
            <!-- shape3 -->
            <svg class="wave-fill shape3" width="294" height="278" viewBox="0 0 294 278">
                <g clip-path="url(#clip-shape3)">
                    <rect class="fill-rect" x="0" y="278" width="294" height="278" fill="#fff" />
                    <g class="wave-group" style="transform:translateY(100%);">
                        <use xlink:href="#wave" class="water_wave water_wave_back" fill="white" y="250" />
                        <use xlink:href="#wave" class="water_wave water_wave_front" fill="white" y="250" />
                    </g>
                    <path class="draw-path"
                        d="M292.864 106.604L250.046 277H43.9541L1.13477 106.604L147.009 1.2334L292.864 106.604Z"
                        stroke="white" stroke-width="2" fill="none" />
                </g>
            </svg>
            <!-- shape4 -->
            <svg class="wave-fill shape4" width="312" height="263" viewBox="0 0 312 263">
                <g clip-path="url(#clip-shape4)">
                    <rect class="fill-rect" x="0" y="263" width="312" height="263" fill="#fff" />
                    <g class="wave-group" style="transform:translateY(100%);">
                        <use xlink:href="#wave" class="water_wave water_wave_back" fill="white" y="240" />
                        <use xlink:href="#wave" class="water_wave water_wave_front" fill="white" y="240" />
                    </g>
                    <path class="draw-path"
                        d="M233.431 1L310.837 131.5L233.431 262H78.5693L1.16211 131.5L78.5693 1H233.431Z" stroke="white"
                        stroke-width="2" fill="none" />
                </g>
            </svg>
        </div>
    </section>
    <script>
        gsap.registerPlugin(MotionPathPlugin, ScrollToPlugin, ScrollTrigger);

        // box div의 물 차오름
        const water = document.getElementById("water");
        let percent = 0;
        const interval = setInterval(() => {
            percent++;
            water.style.transform = `translate(0, ${100 - percent}%)`;
            if (percent === 100) clearInterval(interval);
        }, 60);

        // 도형별 선 그리기 및 점 이동 애니메이션
        const drawTimeline = gsap.timeline({ defaults: { ease: "power2.inOut" } });
        const paths = document.querySelectorAll('.wave-fill .draw-path');
        paths.forEach((pathEl, idx) => {
            const pathLength = pathEl.getTotalLength();
            gsap.set(pathEl, { strokeDasharray: pathLength, strokeDashoffset: pathLength });

            const svgEl = pathEl.ownerSVGElement;
            const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            dot.setAttribute("r", 5);
            dot.setAttribute("fill", "white");
            dot.setAttribute("class", "draw_dot");
            dot.setAttribute("opacity", "0");
            pathEl.parentNode.appendChild(dot);

            // 선 그리기
            drawTimeline.to(pathEl, { strokeDashoffset: 0, duration: 2 }, 0);

            // 점 이동
            drawTimeline.to(dot, { opacity: 1, duration: 0.2 }, 0);
            drawTimeline.to(dot, {
                motionPath: {
                    path: pathEl,
                    align: pathEl,
                    autoRotate: false,
                    alignOrigin: [0.5, 0.5],
                    start: 0,
                    end: 1
                },
                duration: 2
            }, 0);
            drawTimeline.to(dot, { opacity: 0, duration: 0.2 }, ">0.1");
        });

        // 선 그리기 애니 끝난 후 wave-group 차오름
        const waveGroups = document.querySelectorAll('.wave-group');
        const fillRects = document.querySelectorAll('.fill-rect');
        drawTimeline.eventCallback("onComplete", () => {
            fillRects.forEach((rect, i) => {
                gsap.to(rect, { attr: { y: 0 }, duration: 1, ease: "power2.inOut" });
            });
            waveGroups.forEach((wave, i) => {
                gsap.fromTo(
                    { y: heights[i] },
                    {
                        y: 0,
                        duration: 1,
                        ease: "power2.inOut",
                        onUpdate: function () {
                            wave.setAttribute("transform", `translate(0,${this.targets()[0].y})`);
                        }
                    }
                );
            });
        });

    </script>
</body>

</html>